<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Testing Angular</title>

    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/reveal.css">
    <link rel="stylesheet" href="/css/theme/black.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="/lib/css/monokai.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? '/css/print/pdf.css' : '/css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <!-- Title -->
        <section>
            <h1>Testing <img class="inline" src="./assets/angular.svg"></h1>
            <p>En præsentation omhandlende hvordan vi unit-tester i Angular</p>
        </section>

        <!-- Table of contents -->
        <section>
            <h1>Agenda</h1>
            <p>Vi skal igennem:</p>
            <ul>
                <li>Hvorfor skal vi teste?</li>
                <li>Jasmine og Matchers</li>
                <li>Angular's TestBed</li>
                <li>ngMocks</li>
                <li>Spectator</li>
            </ul>
        </section>

        <!-- Why Test? -->
        <section>
            <!-- Intro -->
            <section data-background="https://media.giphy.com/media/3o72FdPFIn4VjDDfMc/giphy.gif">
                <h2>Hvorfor?</h2>
                <p>Hvorfor skal vi teste vores kode?</p>
            </section>

            <!-- Reasoning -->
            <section>
                <h2>Fordi!</h2>
                <ul>
                    <li>Vi udtrykker krav til kode, og fastholder disse vha. tests</li>
                    <li>Hvis vi ikke tester, så starter vi basalt set ud med <b>teknisk gæld</b>!</li>
                </ul>
            </section>

            <!-- Types of testing --->
            <section>
                <h2>Forskellige typer tests</h2>
                <ul>
                    <li>
                        Unit Tests
                        <p>Tester en énkelt enhed. Hurtige at eksekvere.<br>"White box"-testing.</p>
                    </li>
                    <li class="fragment">
                        Integration Tests
                        <p>Tester integrationer mellem unit tests.<br>"Grey box"-testing.</p>
                    </li>
                    <li class="fragment">End-to-end Tests
                        <p>Tester et helt system fra ende til anden.<br>"Black box"-testing.</p>
                    </li>
                    <li class="fragment">UI Tests
                        <p>Tester "på glasset"".<br>"Black box"-testing.</p>
                    </li>
                </ul>
            </section>

            <!-- Unit Testing -->
            <section>
                <h2>Unit Tests</h2>
                <p>Er hvad vi fokuserer på i denne præsentation</p>
                <ul>
                    <li class="fragment">Tester én enhed
                        <p>(som i traditionel OO er én klasse)</p>
                    </li>
                    <li class="fragment">Testes i isolation fra omverdenen</li>
                    <li class="fragment">Er hurtige at eksekvere</li>
                    <li class="fragment">Er nemme at skrive
                        <p>(er under udviklerens kontrol)</p>
                    </li>
                </ul>
            </section>
        </section>

        <!-- Jasmine and Matchers -->
        <section>
            <!-- Intro to Jasmine -->
            <section>
                <h2>
                    <img class="inline" src="./assets/jasmine.svg">
                    Jasmine og Matchers
                </h2>
                <p>Jasmine er i sig selv et test-, mock/spy- og matcher framework.</p>
                <p>Angular bygger ovenpå dette ved at bruge <img class="inline" src="./assets/karma.svg"> Karma, til eksekvere disse tests</p>
            </section>

            <!-- Test setup -->
            <section>
                <h2>Setup</h2>
                <pre><code class="hljs" data-trim data-line-numbers="2-4|6-8|10-12|14-16">
describe('Scenario or unit under test', () => {
    beforeAll(() => {
        // Én gang før tests'ne i "describe"-blokken eksekveres
    });

    afterAll(() => {
        // Én gang efter tests'ne i "describe"-blokken er eksekveret
    });

    beforeEach(() => {
        // Hver gang, før en test eksekveres
    });

    afterEach(() => {
        // Hver gang, efter en test eksekveres
    });
});
					</code></pre>
            </section>

            <!-- Testing -->
            <section>
                <h2>Tests</h2>
                <pre><code class="hljs" data-trim data-line-numbers="2-4|6-15">
describe('CalculatorService', () => {
    it('should be possible to reset the service', () => {
        // Implementering af test placeres her
    });

    describe('division', () => {
        // Tests kan underopdeles (nestes) i "describe"-blokke

        it('should be able to divide two numbers', () => {
            // ...
        });

        it('should not be possible to divide by zero', () => {
            // ...
        });
    });
});
					</code></pre>
            </section>

            <!-- Matchers -->
            <section>
                <h2>Matchers</h2>
                <p>Jasmine kommer med en del indbyggede matchers...</p>
                <pre><code class="hljs">expect(instance).toBe(instance);
expect(number).toBeCloseTo(number, decimalPlaces);
expect(mixed).toBeDefined();
expect(mixed).toBeFalsy();
expect(number).toBeGreaterThan(number);
expect(number).toBeLessThan(number);
expect(number).toBeNaN();
expect(mixed).toBeNull();
expect(mixed).toBeTruthy();
expect(mixed).toBeUndefined();
expect(array).toContain(member);
expect(mixed).toEqual(mixed);
expect(spy).toHaveBeenCalled();
expect(spy).toHaveBeenCalledTimes(number);
expect(spy).toHaveBeenCalledWith(...arguments);
expect(mixed).toMatch(pattern);
expect(fn).toThrow(string);
expect(fn).toThrowError(string);
                </code></pre>
            </section>

            <!-- Custom Matchers -->
            <section>
                <h2>Custom Matchers</h2>
                <p>
                    ...hvis du ikke kan finde en matcher som dækker dit behov, så
                    kan du skrive din egen.
                </p>
                <p class="fragment">
                    Sandsynligheden for at den du skal bruge allerede findes, er relativ stor!
                </p>
            </section>

            <!-- Spies and Mocks -->
            <section>
                <p>Lad os kigge på Spies og Mocks, med følgende kontekst:</p>
                <pre><code class="hljs">class NameRegistry {
    names = ['John', 'Paul', 'George', 'Ringo' ]
    getName() { return this.names[Math.floor(Math.random() * this.names.length)]}
}
class Greeter {
    constructor(private registry: NameRegistry) {};
    greet(greeting: string) { return `${greeting}, ${this.registry.getName()}!`; );
}
</code></pre>
            </section>

            <!-- Spies -->
            <section>
                <h2>Spy</h2>
                <pre><code class="hljs" data-trim data-line-numbers="5">
describe('Greeter', () => {
    it('should greet with random name', () => {
        const registry = new NameRegistry();
        const greeter = new Greeter(registry);
        spyOn(registry, 'getName');

        greeter.greet('Hello there');

        expect(registry, 'getName').toHaveBeenCalled();
    });
});
                </code></pre>
            </section>

            <!-- Mocks -->
            <section>
                <h2>Mock</h2>
                <pre><code class="hljs" data-trim data-line-numbers="5">
describe('Greeter', () => {
    it('should greet with random name', () => {
        const registry = new NameRegistry();
        const greeter = new Greeter(registry);
        spyOn(registry, 'getName').and.returnValue('Bobby');

        const greeeting = greeter.greet('Hello there');

        expect(greeting).toBe('Hello there, Bobby');
    });
});
                </code></pre>
            </section>

            <!-- Rules for testing in Jasmine -->
            <section>
                <h2>Regler for at teste</h2>
                <ul>
                    <li>Beskriv altid hvad du tester</li>
                    <li class="fragment">Test "edge cases"</li>
                    <li class="fragment">Tilstand (State) må ikke deles mellem tests</li>
                    <li class="fragment">Brug en passende matcher</li>
                    <li class="fragment">
                        Forsøg at opdele i følgende struktur
                        <ul>
                            <li>Arrange</li>
                            <li>Act</li>
                            <li>Assert</li>
                        </ul>
                        (ikke en regel, men gør det lettere at læse tests, som er skrevet således).
                    </li>
                </ul>
            </section>
        </section>

        <!-- TestBed -->
        <section>
            <h2>Angular's TestBed</h2>
        </section>

        <!-- ngMocks -->
        <section>
            <h2>ng-mocks</h2>
            <p>Et 3. parts library, som kan hentes herfra:
                <a href="https://github.com/ike18t/ng-mocks">https://github.com/ike18t/ng-mocks</a>
            </p>
        </section>

        <!-- @ngneat/spectator -->
        <section>
			<!-- Title slide -->
			<section>
				<h2>Spectator</h2>
				<p>Et 3. parts library som kan hentest herfra:
					<a href="https://github.com/ngneat/spectator/">https://github.com/ngneat/spectator/</a>
				</p>
				<img class="inline" src="./assets/spectator.svg">
			</section>
        </section>

		<!-- Final slide (link to presentation etc.) -->
		<section>
			<h2>Disse slides?</h2>
			<p>
				Kan hentes og ses hos:
				<a href="https://presentations.skarby.info/presentations/angular/testing">https://presentations.skarby.info/</a>
			</p>
		</section>
    </div>
</div>

<script src="/js/reveal.js"></script>

<script>
    // More info about config & dependencies:
    // - https://github.com/hakimel/reveal.js#configuration
    // - https://github.com/hakimel/reveal.js#dependencies
    Reveal.initialize({
        hash: true,
        dependencies: [
            {src: '/plugin/markdown/marked.js'},
            {src: '/plugin/markdown/markdown.js'},
            {src: '/plugin/highlight/highlight.js'},
            {src: '/plugin/notes/notes.js', async: true}
        ]
    });
</script>
</body>
</html>
